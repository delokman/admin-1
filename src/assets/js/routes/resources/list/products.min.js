!function(){"use strict";var C,M,t=window.tabId,n=window.Tabs[t],q=$("#products-list-container"),A=q.find("#products-list-results"),I=q.find("#load-products"),P=window.i18n,d=function(){C=n.data,M=C.hits.hits.map(function(t){return Object.assign({_id:t._id},t._source)})};if(d(),M.length){var j="/"+window.location.hash+"/",i="",S=[],T=0,F=-1,O=0,l={},r=!1,o=function(t,a,e){if(!r){var s;""!==i?(s={bool:{must:{multi_match:{query:i,fields:["name","keywords"]}}}},S.length&&(s.bool.filter=S)):S.length&&(s={bool:{filter:S}});e||q.addClass("ajax"),t?T++:(T=0,F=-1),r=!0,n.load(function(){r=!1,"function"!=typeof e?(d(),m()):e()},s,l,T,a)}};I.click(function(){o(!0)}),n.pagination=function(t){o(!t)};var N=$("<div>"),E=$("<form>",{action:"javascript:;",submit:o,html:['<div class="form-group"><input class="form-control text-monospace" placeholder="SKU" type="text" name="sku" data-filter="term"/></div>',N,'<label class="i18n"><span data-lang="en_us">Price</span><span data-lang="pt_br">Preço</span></label><div class="flexbox"><div class="form-group"><input class="form-control" type="tel" name="price" data-opt="gte" data-filter="range" data-is-number="true" data-money="true"/><small class="form-text i18n"><span data-lang="en_us">Minimun</span><span data-lang="pt_br">Mínimo</span></small></div><div class="form-group"><input class="form-control" type="tel" name="price" data-opt="lte" data-filter="range" data-is-number="true" data-money="true"/><small class="form-text i18n"><span data-lang="en_us">Maximum</span><span data-lang="pt_br">Máximo</span></small></div></div><label class="i18n"><span data-lang="en_us">Quantity</span><span data-lang="pt_br">Quantidade</span></label><div class="flexbox"><div class="form-group"><input class="form-control" type="number" name="quantity" data-opt="gte" data-filter="range" data-is-number="true"/><small class="form-text i18n"><span data-lang="en_us">Minimun</span><span data-lang="pt_br">Mínimo</span></small></div><div class="form-group"><input class="form-control" type="number" name="quantity" data-opt="lte" data-filter="range" data-is-number="true"/><small class="form-text i18n"><span data-lang="en_us">Maximum</span><span data-lang="pt_br">Máximo</span></small></div></div>']}),a=function(){S=[],o()};q.find("#clear-products-filters").click(a);var e=$("#qvx");e.find("#qvx-title").text(P({en_us:"Filter products",pt_br:"Filtrar produtos"}));var s=$("#modal-center");s.find("input[data-money]").inputMoney();var u=$("#priceToSell"),p=$("#quantityFixed"),c=$("#products-bulk-action");c.find(".edit-selected").click(function(){0<!n.selectedItems.length?(console.log(n.selectedItems),app.toast(P({en_us:"No items selected",pt_br:"Nenhum item selecionado"}))):c.find("button").attr("data-toggle","dropdown")}),s.find("#saveModal").click(function(){var t=n.selectedItems;if(t)for(var a=0;a<t.length;a++)window.callApi("products/"+t[a]+".json","GET",function(t,a){if(t)console.log(t);else{var e,s=a.price,n=a.quantity,i=(s-s*($("#discountSell").val()/100)).toFixed(2),l=u.val().replace("R$","").replace(",",".").trim(),r=parseFloat(l),o=p.val();e=o||parseInt(n);var c={price:r||parseFloat(i),quantity:e};window.callApi("products/"+a._id+".json","PATCH",function(t,a){t||(d(),m(),app.toast(P({en_us:"Completed edit",pt_br:"Editação em massa completa"})))},c)}})}),s.find(".modal-title").text(P({pt_br:"Editar em massa",en_us:"Mass edit"})),e.find("#qvx-body").html(E),e.find("#qvx-footer").html([$("<button>",{class:"btn btn-success mr-2",click:function(){o(),quickview.close(e)},html:P({en_us:"Apply filters",pt_br:"Aplicar filtros"})}),$("<button>",{class:"btn btn-warning",click:function(){a(),quickview.close(e)},html:P({en_us:"Clear",pt_br:"Limpar"})})]);var Q=function(a,e,t,s){s.on("change",function(){$(this).is(":checked")?n.selectedItems.push(a):n.selectedItems=$.grep(n.selectedItems,function(t){return t!==a})}),t.click(function(){n.state.page=e,n.state.pagination=function(t){-1<(e+=t?-1:1)&&(n.state.page=e,T=e-1,o(!0,1,function(){var t=n.data.hits.hits[0];t&&(window.location=j+t._id)}))}})},m=function(){for(var t=[],a=M.length,e=C.hits.total,s=C.aggregations,n=0;n<a;n++){F++;var i,l,r=M[n],o=j+r._id;i=r.price?formatMoney(r.price,r.currency_id):P({en_us:"No price",pt_br:"Sem preço"}),l=r.quantity?r.quantity+" un":"∞";var c="";if(r.pictures&&r.pictures.length){var d=r.pictures[0],u=d.small;if(!u)for(var p in d)if(d.hasOwnProperty(p)&&"_id"!==p){u=d[p];break}u&&(c='<img src="'+u.url+'">')}var m=$("<input>",{class:"custom-control-input",type:"checkbox"}),f=$("<div>",{class:"col item-product",html:['<a href="'+o+'" class="item-picture">'+c+'</a><div class="item-info"><a href="'+o+'">'+r.name+'</a><div class="item-price">'+i+'</div><span class="text-muted"><i class="mr-2 fa fa-'+(r.visible?"eye":"eye-slash")+'"></i><i class="mr-2 fa fa-'+(r.available?"check":"close")+'"></i></span><span class="item-qnt">'+l+"</span></div>",$("<div>",{class:"custom-controls-stacked",html:$("<div>",{class:"custom-control custom-checkbox",html:[m,$("<label>",{class:"custom-control-label",html:'<span class="item-sku">'+r.sku+"</span>"})]})})]});t.push(f),Q(r._id,F,f,m)}0===T?0<e?A.html($("<div>",{class:"row row-products",html:t})):A.html(""):A.children(".row").append(t),a<e?(I.removeAttr("disabled"),0===T&&(O=a)):I.attr("disabled",!0);var v=q.find("#products-list-info");if(0===e)v.hide();else{v.show(),v.find("#products-list-count").text(O*T+a),v.find("#products-list-total").text(e);var h=v.find("#products-avg-price");s.avg_price.value?h.text(formatMoney(s.avg_price.value)+" ("+formatMoney(s.min_price.value)+" - "+formatMoney(s.max_price.value)+")"):h.text(" ~ ")}N.html("");var b={"brands.name":{label:P({en_us:"Brands",pt_br:"Marcas"})},"categories.name":{label:P({en_us:"Categories",pt_br:"Categorias"})},status:{label:"Status"}};for(var g in b)if(b.hasOwnProperty(g)&&s.hasOwnProperty(g)){var _=b[g],y=s[g].buckets;if(y.length){var x="";for(n=0;n<y.length;n++){var k=y[n].key;x+='<option value="'+k+'" data-subtext="('+y[n].doc_count+')">'+k+"</option>"}var w=$("<select />",{multiple:!0,"data-live-search":!0,class:"form-control",name:g,html:x});N.prepend($("<div />",{class:"form-group selectpicker-default",html:w})),w.selectpicker({style:"btn-light",noneSelectedText:_.label,windowPadding:70})}}q.removeClass("ajax"),handleInputs(E,function(t,a){var e=t.attr("name"),s=t.data("opt"),n=t.data("filter")||"terms",i=t.val();console.log(!Array.isArray(i)),Array.isArray(i)?i.length||(i=null):(i=t.data("is-number")?stringToNumber(i):"number"===t.attr("type")?parseFloat(i):i.trim(),isNaN(i)&""===i&&(i=null));for(var l=0;l<S.length;l++){var r=S[l][n];if(r&&r.hasOwnProperty(e))return void(s?null!==i?r[e][s]=i:(delete r[e][s],Object.keys(r[e]).length||S.splice(l,1)):null!==i?r[e]=i:S.splice(l,1))}if(null!==i){var o={};o[n]={},s?(o[n][e]={},o[n][e][s]=i):o[n][e]=i,S.push(o)}})},f=q.find("#search-products"),v=f.find("input");v.attr("placeholder",P({en_us:"Polo Shirt",pt_br:"Camisa Polo"})),f.submit(function(){i=v.val().trim(),o()}),q.find("#order-products a").click(function(){var t,a={desc:"fa-caret-down text-warning",asc:"fa-caret-up text-info"};if($(this).hasClass("active")){var e=$(this).data("sort");t="desc"===e?"asc":"desc",$(this).data("sort",t).find("i").removeClass(a[e]).addClass(a[t])}else t="desc",$(this).parent().children(".active").removeClass("active").removeData("sort").find("i").remove(),$(this).addClass("active").data("sort",t).append($("<i>",{class:"ml-1 fa "+a.desc}));(l={})[$(this).data("field")]={order:t},o()}),n.editItemsCallback=function(){return q.addClass("ajax"),function(t){Array.isArray(t)&&!t.length?A.find("input:checked").closest(".item-product").fadeOut(400,function(){q.removeClass("ajax")}):o()}},$("#select-all-products").on("change",function(){var t=$(this).is(":checked")?":not(:checked)":":checked";return A.find('input[type="checkbox"]'+t).each(function(t){var a=$(this);setTimeout(function(){a.next().click()},20*t)}),!0}),m()}setTimeout(function(){window.unsetSaveAction()},200)}();