!function(){"use strict";var n=window.tabId,a=window.Tabs[n],e=$("#t"+n+"-tab-normal"),o=e.children("form");window.renderContentIds(e);var r,s,k=window.i18n,l=function(e,t,i,n){o.addClass("ajax");window.callApi(e,t,function(e,t){o.removeClass("ajax"),e||i(t)},n)},y=a.commit,x=function(){return a.data},c=a.slug,m=a.resourceId,u=!!o.find('[name="slug"]').length;if(m){s=c+"/"+m+".json";var t=function(){l(s,"DELETE",function(e){window.location="/#/resources/"+c})};$("#t"+n+"-delete").click(t),e.find(".delete-resource").click(t).fadeIn(),$("#t"+n+"-duplicate").click(function(){l(c+".json","POST",function(e){window.location="/#/resources/"+c+"/"+e._id},x())}),$("#t"+n+"-new").click(function(){window.location="/#/resources/"+c+"/new"}),u?window.callApi("stores/me.json","GET",function(e,i){if(e)t=function(e){if((window.shopDomain||localStorage.getItem("domain"))&&x().slug){var t="https://"+(localStorage.getItem("domain")||window.shopDomain)+"/"+x().slug;e&&(t=e+encodeURIComponent(t)),newTabLink(t)}else app.toast(k({en_us:"No link to share",pt_br:"Nenhum link para compartilhar"}))},$("#t"+n+"-view").click(function(){t()}),$("#t"+n+"-facebook").click(function(){t("https://www.facebook.com/sharer.php?u=")}),$("#t"+n+"-whatsapp").click(function(){var e;e=$(window).width()<480?"api":"web",t("https://"+e+".whatsapp.com/send?text=")});else{var t=function(e){if((window.shopDomain||i.domain)&&x().slug){var t="https://"+(i.domain||window.shopDomain)+"/"+x().slug;e&&(t=e+encodeURIComponent(t)),newTabLink(t)}else app.toast(k({en_us:"No link to share",pt_br:"Nenhum link para compartilhar"}))};$("#t"+n+"-view").click(function(){t()}),$("#t"+n+"-facebook").click(function(){t("https://www.facebook.com/sharer.php?u=")}),$("#t"+n+"-whatsapp").click(function(){var e;e=$(window).width()<480?"api":"web",t("https://"+e+".whatsapp.com/send?text=")})}}):$("#t"+n+"-view, #t"+n+"-facebook, #t"+n+"-whatsapp").remove(),$("#t"+n+"-nav .edit-btn").fadeIn()}else r=!0,s=c+".json";var i=0,f=0,h=function(){if(i<=++f){var p,m=function(e,t){if(""===(t=t.trim()))return null;if(e.data("json")){var i;try{i=JSON.parse(t)}catch(e){i=!1}return i}return t},e=function(e,t){if(p){var i=e.attr("name");if(i&&""!==i){var n,a=x(),o=i.split(".");if(o.length){var r,s=e.data("object-id");for(n=0;""!==o[n]&&(0<n&&(a=a[i]),r?(i=parseInt(o[n],10),r=!1):(/\[\]$/.test(o[n])&&(r=!0,o[n]=o[n].slice(0,-2)),i=o[n])),n!==o.length-1;){if(a.hasOwnProperty(i)||(a[i]=s?[{_id:s}]:r?[]:{}),s){for(var l=0;l<a[i].length;l++)if(a[i][l]._id===s){o.splice(n+1,0,l),s=null;break}s&&(a[i].push({_id:s}),o.splice(n+1,0,a[i].length-1),s=null)}n++}}var c=function(){Array.isArray(a)?a.splice(i,1):1===o.length?a[i]="":(console.log(a),console.log(o),console.log(i),console.log(a[i]),console.log(a),delete a[i])};if(t)a[i]=e.is(":checked");else{var u,f=e.data("value")||e.val();if(e.hasClass("colorpicker")&&!/^#[a-f0-9]{6}$/.test(f)&&""!==f)return void setTimeout(function(){e.trigger("change")},200);if("string"==typeof f)if((u=e.data("is-number")?stringToNumber(f):"number"===e.attr("type")?parseFloat(f):m(e,f))||0===u)if(e.data("object-assign"))Object.assign(a[i],u);else{if(Array.isArray(a))for(;a.length<i;)a.push(u);a[i]=u}else{if(null!==u&&!isNaN(u))return;c()}else if(Array.isArray(f)){var d=[];for(n=0;n<f.length;n++)(u=m(e,f[n]))&&d.push(u);if(d.length)a[i]=d;else{if(!a.hasOwnProperty(i))return;c()}}}y(x(),!0)}}};a.inputToData=e,handleInputs(o,e);var t=function(){r?setTimeout(function(){o.find('[type="checkbox"]').trigger("change")},100):setupInputValues(o,x()),o.find(".tagsinput").tagsinput(),o.find("select:not(.tagsinput)").selectpicker({style:"btn-light",noneSelectedText:"--",windowPadding:70});var b=o.find(".html-editor");if(b.length){var i=!1;b.summernote({toolbar:[["style",["style"]],["font",["bold","italic","underline","strikethrough","clear"]],["color",["color"]],["insert",["picture","link","video","hr","table"]],["paragraph",["ul","ol","paragraph"]],["misc",["codeview","help"]]],height:300,dialogsFade:!0,callbacks:{onChange:function(e){i=!0;var t=e.trim();"<div>"!==t.substring(0,5)&&b.summernote("code","<div><br></div>"+t)},onBlur:function(){i&&(b.trigger("change"),i=!1)}}})}o.find('input[type="file"]').each(function(){var e,d,p,m,h,g;e=(d=$(this).attr("multiple"))?((m=$(this).data("max"))||(m=50),k({en_us:"Select images",pt_br:"Selecionar imagens"})):(m=1,k({en_us:"Select image",pt_br:"Selecionar imagem"})),h=$(this).attr("name"),p=$(this).data("thumbnails");var t=function(e,n,t){if(!e){var i=x();if(i.hasOwnProperty(h)){var a=function(e){if(e){if(!p){var t=e.url;e={zoom:e},-1!==t.indexOf("digitaloceanspaces.com/@")?e.normal={url:t.replace(/^((https?:)?\/\/[^/]+\/)(.*)$/,"$1imgs/400px/$3")}:e.normal=e.zoom}n.push(e)}};if(d)for(g=0;g<i[h].length;g++){a(i[h][g])}else n.length||a(i[h])}if(!n.length)return;if(n.length>m&&(d?(p&&n.splice(m,n.length-m),app.toast(k({en_us:"A maximum of "+m+" images will be selected",pt_br:"No máximo "+m+" imagens serão selecionadas"}))):app.toast(k({en_us:"Only one image will be selected",pt_br:"Apenas uma imagem será selecionada"}))),!w){v.addClass("ajax");var o=v.children(".images-list");o.html("");var r=0,s=0,c=[],u=function(){++s===r&&(o.prepend(c),v.removeClass("ajax"),1<s&&window.Sortable.create(o[0],{onUpdate:function(e){var t=x(),i=t[h].splice(e.oldIndex,1)[0];i&&(t[h].splice(e.newIndex,0,i),y(t,!0))}}))};if(!t){if(d){i[h]=[];var l=randomObjectId();for(g=0;g<n.length;g++){var f;(f=p?n[g]:n[g].zoom)._id||(f._id=objectIdPad(l,""+g)),i[h].push(f)}}else i[h]=p?n[0]:n[0].zoom;y(i,!0)}}for(g=0;g<n.length&&g<m;g++)!function(){var i,l;if(i=w?n[g].zoom.url:(r++,n[g].normal.url),w||c.push($("<span />",{html:'<img src="'+i+'"><i class="fa fa-cog"></i>',click:(l=h,function(e){e.stopPropagation();var o=$(this),r=x(),s=r[l];Array.isArray(s)&&(s=s[o.index()]),window.editImage(function(e,t){if(!e){if(!1===t)Array.isArray(r[l])?r[l].splice(o.index(),1):delete r[l],o.toggle("slide",function(){$(this).remove()});else if("object"==typeof s)for(var i in t){var n=t[i];if(n)if(s.hasOwnProperty("zoom"))if("size"!==i)for(var a in s)s.hasOwnProperty(a)&&(s[a][i]=n);else s.zoom[i]=n;else s[i]=n}y(r,!0)}},s.zoom||s)})})),w)b.summernote("insertImage","/assets/img/util/loading.gif",function(e){var t=new Image;t.onload=function(){e.attr("src",i),b.summernote("insertText"," ")},t.src=i,e.css("max-width","100%")});else{var e=new Image;e.onload=function(){u(),clearTimeout(t)};var t=setTimeout(u,5e3);e.src=i}}()}},w=$(this).hasClass("note-image-input"),v=$("<div/>",{class:"select-image scrollable scrollable-x ajax-content",html:'<div class="ajax-overlay"><div class="spinner-circle-material"></div></div><div class="images-list"></div><p><i class="fa fa-picture-o"></i>&nbsp; '+e+"</p>",click:function(){var e;e=w?(o.find(".note-editor .modal.show").modal("hide"),400):100,window.setImagesCallback(t),setTimeout(function(){window.upload()},e)}});$(this).replaceWith(v),r||t(null,[],!0)}),setTimeout(function(){window.setSaveAction(o,function(i){setTimeout(function(){var e,t=x();r?(e="POST",t.name&&!t.slug&&u&&(t.slug=clearAccents(t.name.toLowerCase(),"-").replace(/[^a-z0-9-_./]/g,""))):e="PATCH";l(s,e,function(e){"function"==typeof i&&i(n),"function"==typeof a.saveCallback&&a.saveCallback(e),r&&e._id&&(window.location="/#/resources/"+c+"/"+e._id)},t)},200)})},200),p=!0,fixScrollbars(o),o.removeClass("ajax ajax-cards")};a.$form=o,$(document).trigger("form-"+n),a.wait?(a.formSetup=function(){setTimeout(t,100)},"function"==typeof a.continue&&a.continue()):setTimeout(t,200)}},d=o.find("select").filter(function(){return $(this).data("fill")});d.length?d.each(function(){var e=$(this).data("fill");i++;var u=[$(this)];o.find('select[data-fill-same="'+$(this).attr("name")+'"]').each(function(){u.push($(this))});var f,d,t=e+".json?sort="+($(this).data("sort")||"name"),p=$(this).data("properties");p&&(d=!0,t+="&fields="+p,(f=$(this).data("subtext-property"))&&(t+=","+f)),window.callApi(t,"GET",function(e,t){if(!e){var i=t.result;if(i)for(var n=0;n<i.length;n++){var a=i[n];if(a._id!==m){var o,r;if(d)r=p?getProperties(a,p):a,o=JSON.stringify(r);else o=a._id;var s={value:o,text:cutString(a.name,42,"...")};if(f){var l=getFromDotNotation(a,f);l&&(s["data-subtext"]=cutString(l,45,"..."))}for(var c=0;c<u.length;c++)$("<option />",s).appendTo(u[c])}}}h()})}):h()}();