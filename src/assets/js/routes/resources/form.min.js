!function(){"use strict";var n=window.tabId,i=window.Tabs[n],e=$("#t"+n+"-tab-normal"),a=e.children("form");window.renderContentIds(e);var o,r,y=window.i18n,s=function(e,t,i,n){a.addClass("ajax");window.callApi(e,t,function(e,t){a.removeClass("ajax"),e||i(t)},n)},x=i.commit,k=function(){return i.data},l=i.slug,m=i.resourceId,c=!!a.find('[name="slug"]').length;if(m){r=l+"/"+m+".json";var t=function(){s(r,"DELETE",function(e){window.location="/#/resources/"+l})};if($("#t"+n+"-delete").click(t),e.find(".delete-resource").click(t).fadeIn(),$("#t"+n+"-duplicate").click(function(){s(l+".json","POST",function(e){window.location="/#/resources/"+l+"/"+e._id},k())}),$("#t"+n+"-new").click(function(){window.location="/#/resources/"+l+"/new"}),c){var f=function(e){if(window.shopDomain&&k().slug){var t="https://"+window.shopDomain+"/"+k().slug;e&&(t=e+encodeURIComponent(t)),newTabLink(t)}else app.toast(y({en_us:"No link to share",pt_br:"Nenhum link para compartilhar"}))};$("#t"+n+"-view").click(function(){f()}),$("#t"+n+"-facebook").click(function(){f("https://www.facebook.com/sharer.php?u=")}),$("#t"+n+"-whatsapp").click(function(){var e;e=$(window).width()<480?"api":"web",f("https://"+e+".whatsapp.com/send?text=")})}else $("#t"+n+"-view, #t"+n+"-facebook, #t"+n+"-whatsapp").remove();$("#t"+n+"-nav .edit-btn").fadeIn()}else o=!0,r=l+".json";var h=0,u=0,g=function(){if(h<=++u){var p,m=function(e,t){if(""===(t=t.trim()))return null;if(e.data("json")){var i;try{i=JSON.parse(t)}catch(e){i=!1}return i}return t},e=function(e,t){if(p){var i=e.attr("name");if(i&&""!==i){var n,a=k(),o=i.split(".");if(o.length){var r,s=e.data("object-id");for(n=0;""!==o[n]&&(0<n&&(a=a[i]),r?(i=parseInt(o[n],10),r=!1):(/\[\]$/.test(o[n])&&(r=!0,o[n]=o[n].slice(0,-2)),i=o[n])),n!==o.length-1;){if(a.hasOwnProperty(i)||(a[i]=s?[{_id:s}]:r?[]:{}),s){for(var l=0;l<a[i].length;l++)if(a[i][l]._id===s){o.splice(n+1,0,l),s=null;break}s&&(a[i].push({_id:s}),o.splice(n+1,0,a[i].length-1),s=null)}n++}}var c=function(){if(Array.isArray(a)?a.splice(i,1):delete a[i],o.length){a=k();for(var e=0;e<o.length-1;e++){var t=o[e];Object.keys(a[t]).length?a=a[t]:delete a[t]}}};if(t)a[i]=e.is(":checked");else{var f,u=e.data("value")||e.val();if(e.hasClass("colorpicker")&&!/^#[a-f0-9]{6}$/.test(u)&&""!==u)return void setTimeout(function(){e.trigger("change")},200);if("string"==typeof u)if((f=e.data("is-number")?stringToNumber(u):"number"===e.attr("type")?parseFloat(u):m(e,u))||0===f)if(e.data("object-assign"))Object.assign(a[i],f);else{if(Array.isArray(a))for(;a.length<i;)a.push(f);a[i]=f}else{if(null!==f&&!isNaN(f))return;c()}else if(Array.isArray(u)){var d=[];for(n=0;n<u.length;n++)(f=m(e,u[n]))&&d.push(f);if(d.length)a[i]=d;else{if(!a.hasOwnProperty(i))return;c()}}}x(k(),!0)}}};i.inputToData=e,handleInputs(a,e);var t=function(){o?setTimeout(function(){a.find('[type="checkbox"]').trigger("change")},100):setupInputValues(a,k()),a.find(".tagsinput").tagsinput(),a.find("select:not(.tagsinput)").selectpicker({style:"btn-light",noneSelectedText:"--",windowPadding:70});var b=a.find(".html-editor");if(b.length){var i=!1;b.summernote({toolbar:[["style",["style"]],["font",["bold","italic","underline","strikethrough","clear"]],["color",["color"]],["insert",["picture","link","video","hr","table"]],["paragraph",["ul","ol","paragraph"]],["misc",["codeview","help"]]],height:300,dialogsFade:!0,callbacks:{onChange:function(e){i=!0;var t=e.trim();"<div>"!==t.substring(0,5)&&b.summernote("code","<div><br></div>"+t)},onBlur:function(){i&&(b.trigger("change"),i=!1)}}})}a.find('input[type="file"]').each(function(){var e,d,p,m,h,g;e=(d=$(this).attr("multiple"))?((m=$(this).data("max"))||(m=50),y({en_us:"Select images",pt_br:"Selecionar imagens"})):(m=1,y({en_us:"Select image",pt_br:"Selecionar imagem"})),h=$(this).attr("name"),p=$(this).data("thumbnails");var t=function(e,n,t){if(!e){var i=k();if(i.hasOwnProperty(h)){var a=function(e){if(e){if(!p){var t=e.url;e={zoom:e},-1!==t.indexOf("digitaloceanspaces.com/@")?e.normal={url:t.replace(/^((https?:)?\/\/[^/]+\/)(.*)$/,"$1imgs/400px/$3")}:e.normal=e.zoom}n.push(e)}};if(d)for(g=0;g<i[h].length;g++){a(i[h][g])}else n.length||a(i[h])}if(!n.length)return;if(n.length>m&&(d?(p&&n.splice(m,n.length-m),app.toast(y({en_us:"A maximum of "+m+" images will be selected",pt_br:"No máximo "+m+" imagens serão selecionadas"}))):app.toast(y({en_us:"Only one image will be selected",pt_br:"Apenas uma imagem será selecionada"}))),!v){w.addClass("ajax");var o=w.children(".images-list");o.html("");var r=0,s=0,c=[],f=function(){++s===r&&(o.prepend(c),w.removeClass("ajax"),1<s&&window.Sortable.create(o[0],{onUpdate:function(e){var t=k(),i=t[h].splice(e.oldIndex,1)[0];i&&(t[h].splice(e.newIndex,0,i),x(t,!0))}}))};if(!t){if(d){i[h]=[];var l=randomObjectId();for(g=0;g<n.length;g++){var u;(u=p?n[g]:n[g].zoom)._id||(u._id=objectIdPad(l,""+g)),i[h].push(u)}}else i[h]=p?n[0]:n[0].zoom;x(i,!0)}}for(g=0;g<n.length&&g<m;g++)!function(){var i,l;if(i=v?n[g].zoom.url:(r++,n[g].normal.url),v||c.push($("<span />",{html:'<img src="'+i+'"><i class="fa fa-cog"></i>',click:(l=h,function(e){e.stopPropagation();var o=$(this),r=k(),s=r[l];Array.isArray(s)&&(s=s[o.index()]),window.editImage(function(e,t){if(!e){if(!1===t)Array.isArray(r[l])?r[l].splice(o.index(),1):delete r[l],o.toggle("slide",function(){$(this).remove()});else if("object"==typeof s)for(var i in t){var n=t[i];if(n)if(s.hasOwnProperty("zoom"))if("size"!==i)for(var a in s)s.hasOwnProperty(a)&&(s[a][i]=n);else s.zoom[i]=n;else s[i]=n}x(r,!0)}},s.zoom||s)})})),v)b.summernote("insertImage","/assets/img/util/loading.gif",function(e){var t=new Image;t.onload=function(){e.attr("src",i),b.summernote("insertText"," ")},t.src=i,e.css("max-width","100%")});else{var e=new Image;e.onload=function(){f(),clearTimeout(t)};var t=setTimeout(f,5e3);e.src=i}}()}},v=$(this).hasClass("note-image-input"),w=$("<div/>",{class:"select-image scrollable scrollable-x ajax-content",html:'<div class="ajax-overlay"><div class="spinner-circle-material"></div></div><div class="images-list"></div><p><i class="fa fa-picture-o"></i>&nbsp; '+e+"</p>",click:function(){var e;e=v?(a.find(".note-editor .modal.show").modal("hide"),400):100,window.setImagesCallback(t),setTimeout(function(){window.upload()},e)}});$(this).replaceWith(w),o||t(null,[],!0)}),setTimeout(function(){window.setSaveAction(a,function(i){setTimeout(function(){var e,t=k();o?(e="POST",t.name&&!t.slug&&c&&(t.slug=clearAccents(t.name.toLowerCase(),"-").replace(/[^a-z0-9-_./]/g,""))):e="PUT";s(r,e,function(e){"function"==typeof i&&i(n),o&&e._id&&(window.location="/#/resources/"+l+"/"+e._id)},t)},200)})},200),p=!0,fixScrollbars(a),a.removeClass("ajax ajax-cards")};i.$form=a,$(document).trigger("form-"+n),i.wait?(i.formSetup=function(){setTimeout(t,100)},"function"==typeof i.continue&&i.continue()):setTimeout(t,200)}},d=a.find("select").filter(function(){return $(this).data("fill")});d.length?d.each(function(){var e=$(this).data("fill");h++;var f=[$(this)];a.find('select[data-fill-same="'+$(this).attr("name")+'"]').each(function(){f.push($(this))});var u,d,t=e+".json?sort="+($(this).data("sort")||"name"),p=$(this).data("properties");p&&(d=!0,t+="&fields="+p,(u=$(this).data("subtext-property"))&&(t+=","+u)),window.callApi(t,"GET",function(e,t){if(!e){var i=t.result;if(i)for(var n=0;n<i.length;n++){var a=i[n];if(a._id!==m){var o,r;if(d)r=p?getProperties(a,p):a,o=JSON.stringify(r);else o=a._id;var s={value:o,text:cutString(a.name,42,"...")};if(u){var l=getFromDotNotation(a,u);l&&(s["data-subtext"]=cutString(l,45,"..."))}for(var c=0;c<f.length;c++)$("<option />",s).appendTo(f[c])}}}g()})}):g()}();