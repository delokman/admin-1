!function(){"use strict";var r=window.tabId,l=window.Tabs[r],g=l.commit,_=function(){return l.data},t=function(){var t=$("#t"+r+"-doc_number"),i=l.$form.find("#t"+r+"-items-container"),f=i.find("#t"+r+"-cart-items"),o=i.find("#t"+r+"-cart-items-count"),s=i.find("#t"+r+"-cart-subtotal"),u=i.closest("form").find('input[name="subtotal"],input[name="amount.subtotal"]');t.find("#t"+r+"-payment-method-code").change(function(){});var d=function(){setTimeout(function(){var t=_(),i=t.items,e=0,a=0;if(i)for(var n=0;n<i.length;n++){var r=i[n];e+=r.quantity,a+=r[void 0!==r.final_price?"final_price":"price"]*r.quantity}o.text(e);var c=formatMoney(a);s.text(c),t.subtotal!==a&&(u.length?u.val(c).trigger("change"):t.subtotal=a,g(t,!0))},150)},p=function(i,t){var n=i._id,e=function(t){return $("<a>",{href:"/#/resources/products/"+i.product_id,html:t})},a="",r=i.picture;if(r){var c=r.small||r[Object.keys(r)[0]];c&&(a=e('<img src="'+c.url+'">')).addClass("cart-item-picture")}var o=$("<input>",{class:"form-control w-80px",name:"items.quantity",type:"number",min:0,max:9999999,step:"any"}).change(d),s=$("<input>",{class:"form-control w-120px",name:"items."+(void 0!==i.final_price?"final_price":"price"),type:"tel","data-is-number":"true","data-money":"true"}).change(d),u=$("<i>",{class:"py-10 pr-10 remove fa fa-trash"}).click(function(){for(var t=_(),i=t.items,e=0;e<i.length;e++){var a=i[e];if(a&&a._id===n){i.splice(e,1),g(t,!0),d();break}}m.remove()}),m=$("<tr>",{html:[$("<th>",{scope:"row",html:[u,t+1]}),$("<td>",{html:e(i.sku||"")}),$("<td>",{html:o}),$("<td>",{html:s}),$("<td>",{html:$("<input>",{class:"form-control",name:"items.name",type:"text"})}),$("<td>",{html:a})]});f.append(m),m.find("input").data("object-id",n),handleInputs(m,l.inputToData),setupInputValues(m,i,"items.")},e=_().items;if(e&&e.length){for(var a=0;a<e.length;a++)p(e[a],a);d()}var h=[],v=i.find("#t"+r+"-new-cart-item");v.typeahead({hint:!0,highlight:!0,minLength:3},{name:"items",source:function(t,i,c){t=t.replace(/([()])/g,"\\$1").replace(/(^|\s)(AND|OR|\/)(\s|$)/g," ");var e="items.json?q="+encodeURIComponent("sku:"+t+" OR name:"+t);window.callSearchApi(e,"GET",function(t,i){if(!t&&i.hits){h=i.hits.hits;for(var e=0;e<h.length;e++){var a=h[e]._source;if(a.variations&&a.variations.length)for(var n=0;n<a.variations.length;n++){var r=a.variations[n];c([r.name+" ("+r.sku+")"])}else c([a.name+" ("+a.sku+")"])}}})}});var n=function(){var t=v.val().match(/^.*\s\((.*)\)$/);if(t){var i=t[1];if(i&&h.length){for(var e,a,n=0;n<h.length;n++){var r=h[n],c=r._source;if(c.sku!==i){if(c.variations)for(var o=0;o<c.variations.length;o++)if(c.variations[o].sku===i){a=c.variations[o];break}if(!a)continue}(e=c)._id=r._id;break}if(e){var s={_id:randomObjectId(),sku:i,product_id:e._id};if(a){if(a.picture_id&&e.pictures)for(n=0;n<e.pictures.length;n++){var u=e.pictures[n];if(u._id===a.picture_id){a.pictures=[u];break}}s.variation_id=a._id,e=Object.assign(e,a)}s.price=e.price,s.quantity=e.quantity,s.name=e.name,e.pictures&&e.pictures.length&&(s.picture=e.pictures[0],delete s.picture._id);var m=_(),f=m.items;f||(f=m.items=[]);var l=f.length;f[l]=s,g(m),p(s,l),d()}}}};i.find("#t"+r+"-add-cart-item").click(n),v.click(function(){$(this).select()}).keydown(function(t){switch(t.which){case 13:t.preventDefault(),n()}})};l.$form?t():$(document).one("form-"+r,t)}();