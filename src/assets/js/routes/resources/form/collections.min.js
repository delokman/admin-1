!function(){"use strict";var o=window.tabId,c=window.Tabs[o],p=c.commit,h=function(){return c.data},m=window.i18n,t=function(){var t=c.$form.find("#t"+o+"-items-container"),d=t.find("#t"+o+"-collections-items"),u=function(i,t){var e=i._id,r=function(t){return $("<a>",{href:"/#/resources/products/"+i._id,html:t})},n="",o=i.pictures;if(o[0]){var c=o[0].small;c&&(n=r('<img src="'+c.url+'">')).addClass("cart-item-picture")}var a=$("<i>",{class:"py-10 pr-10 remove fa fa-trash"}).click(function(){for(var t=h(),i=0;i<t.products.length;i++)if(t.products[i]===e){t.products.splice(i,1),p(t,!0);break}s.remove()}),s=$("<tr>",{html:[$("<th>",{scope:"row",html:a}),$("<td>",{html:r(i.sku||"")}),$("<td>",{html:$("<input>",{id:"nameProduct",name:"items.name",type:"text"})}),$("<td>",{html:n})]});d.append(s),s.find("input").data("object-id",e),setupInputValues(s,i,"items.")},i=h().products;if(i&&i.length)for(var e=0;e<i.length;e++){var r="products/"+i[e]+".json";window.callApi(r,"GET",function(t,i){if(!t)var e=i;u(e)})}var l=[],f=t.find("#t"+o+"-new-collections-item");f.typeahead({hint:!0,highlight:!0,minLength:3},{name:"items",source:function(t,i,n){t=t.replace(/([()])/g,"\\$1").replace(/(^|\s)(AND|OR|\/)(\s|$)/g," ");var e="items.json?q="+encodeURIComponent("sku:"+t+" OR name:"+t);window.callSearchApi(e,"GET",function(t,i){if(!t&&i.hits){l=i.hits.hits;for(var e=0;e<l.length;e++){var r=l[e]._source;n([r.name+" ("+r.sku+")"])}}})}});var n=function(){var t=f.val().match(/^.*\s\((.*)\)$/);if(t){var i=t[1];if(i&&l.length){for(var e,r=0;r<l.length;r++){var n=l[r],o=n._source;if(o.sku===i){(e=o)._id=n._id;break}}if(e){for(var c,a=h(),s=0;s<a.products.length;s++){if(e._id===a.products[s]){c=null;break}c=e._id}a.products||(a.products=[]);var d=a.products.length;null===c?app.toast(m({en_us:"Error! Already added this product in the collection!",pt_br:"Erro! Esse produto já foi inserido na coleção!"})):(a.products[d]=c,p(a),u(e))}}}};t.find("#t"+o+"-add-collections-item").click(n),f.click(function(){$(this).select()}).keydown(function(t){switch(t.which){case 13:t.preventDefault(),n()}})};c.$form?t():$(document).one("form-"+o,t)}();